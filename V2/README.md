# 财务合规管理系统 V2

## 项目概述

本系统是一个财务合规管理平台，主要用于管理采购SKU明细、合同、发票及其关联关系。

## 🎨 V2 新特性：左侧树状菜单

V2版本采用全新的左侧树状菜单布局，提供更好的导航体验：

### 主要特点
- ✅ **固定左侧菜单**：250px宽度的固定侧边栏，支持一键收起/展开
- ✅ **树状结构**：多级菜单组，清晰的功能分类（采购管理、发票管理、报关管理）
- ✅ **状态保持**：自动保存菜单展开/收起状态，刷新页面不丢失
- ✅ **当前页高亮**：自动高亮当前访问的菜单项
- ✅ **徽章提示**：实时显示各模块的数据统计
- ✅ **键盘快捷键**：`Ctrl+B` 快速切换侧边栏显示
- ✅ **响应式设计**：自适应不同屏幕尺寸

### 详细使用指南
请参阅 [左侧树状菜单使用指南](./TREE_MENU_GUIDE.md) 了解完整的功能说明和技术实现。

---

## 核心功能模块

### 1. 采销SKU明细 (`pages/sku-detail.html`)
- 管理采购SKU明细信息
- 支持自动生成合同和手动生成合同
- 包含以下新增字段（红框标注）：
  - 合同编号
  - 明细状态
  - 是否开票
  - 关联往来对账单ID
  - 供应商编码
  - 采购主体
  - 明细生成时间
- 支持数据筛选、导出功能

### 2. 采销合同管理 (`pages/purchase-contract.html`)
- 合同全生命周期管理（待审核、审核中、签署中、已完成等）
- 支持合同审核、签署流程
- **关键功能：合同与发票关联**
  - 支持一对一关系（一个合同对应一张发票）
  - 支持多对一关系（多个合同对应同一张发票）
  - 显示关联发票编号和关系类型
- 包含以下新增字段：
  - 关联发票编号（高亮显示）
  - 我司签署时间
  - 发票附件
  - 关联往来对账单ID

### 3. 进项发票管理 (`pages/invoice-management.html`)
参照V1实现，包含以下子模块：

#### 3.1 待开票列表
- 记录每次入库或退货产生的待开票需求
- 关联库存池数据
- 支持发票匹配功能

#### 3.2 进项发票列表（供应商开具）
- 登记从供应商收到的增值税发票
- 用于税额抵扣
- 支持批量导入、导出功能
- **关键字段：**
  - 发票代码、发票号码
  - 不含税金额、税率、税额
  - 价税合计
  - 已匹配金额、剩余可用金额
  - 匹配状态

#### 3.3 发票匹配记录（多对多关系）
- 支持一张发票匹配多个待开票记录
- 支持一个待开票记录由多张发票匹配
- 灵活的金额拆分机制
- **业务场景：**
  - 场景1：一对一匹配
  - 场景2：合开发票（一张发票对多个采购单）
  - 场景3：分开发票（一个采购单对多张发票）

#### 3.4 销项发票列表
- 管理出口发票
- 关联FBA订单信息

### 4. 合同-发票关联管理 (`pages/contract-invoice-relation.html`)
专门管理合同与发票之间的关联关系：

#### 4.1 关联关系列表
- 显示所有合同-发票关联记录
- 标注关系类型（一对一/多对一）
- 支持新增、编辑、解除关联

#### 4.2 按发票分组视图
- 展示每张发票关联了哪些合同
- 清晰识别"多对一"关系
- 自动计算金额汇总和匹配状态

#### 4.3 业务场景示例
- **场景1：一对一关系**
  - 合同 HT202511210001 (¥226,000) → 发票 25352000 (¥226,000)
  - 最常见场景：单个采购订单对应单张发票

- **场景2：多对一关系（合并开票）**
  - 合同 HT202511210002 (¥124,300) + 合同 HT202511210003 (¥101,700) → 发票 25352001 (¥226,000)
  - 供应商合并开票场景

## 数据关联关系说明

### 合同 ↔ 发票关系
- **关系类型：** 多对一 或 一对一
- **约束：** 
  - 一个合同只能关联一张发票
  - 一张发票可以被多个合同关联
  - 多对一关系中，发票金额应等于所有关联合同金额之和

### 待开票 ↔ 进项发票关系
- **关系类型：** 多对多
- **特点：**
  - 一张进项发票可以匹配多个待开票记录
  - 一个待开票记录可以由多张进项发票匹配
  - 支持灵活的金额拆分

## 技术栈

- **前端：** HTML5, CSS3, JavaScript (原生)
- **样式：** 自定义CSS，响应式设计
- **数据：** 前端模拟数据（实际应对接后端API）

## 文件结构

```
V2/
├── index.html                          # 首页（功能模块导航）
├── css/
│   └── style.css                       # 全局样式
├── js/
│   ├── main.js                         # 首页脚本
│   ├── sku-detail.js                   # SKU明细页面脚本
│   ├── purchase-contract.js            # 采销合同页面脚本
│   ├── invoice-management.js           # 进项发票管理脚本
│   └── contract-invoice-relation.js    # 合同-发票关联脚本
└── pages/
    ├── sku-detail.html                 # 采销SKU明细
    ├── purchase-contract.html          # 采销合同管理
    ├── invoice-management.html         # 进项发票管理
    ├── contract-invoice-relation.html  # 合同-发票关联
    ├── contract.html                   # 合同管理（占位）
    ├── cost.html                       # 成本分析（占位）
    ├── dashboard.html                  # 数据报表（占位）
    ├── invoice.html                    # 发票管理（占位）
    └── statement.html                  # 对账单管理（占位）
```

## 快速开始

### 本地运行

#### 方式一：使用启动脚本（推荐）

```bash
cd V2
./start.sh
```

然后访问：http://localhost:8000

#### 方式二：直接使用 Python

```bash
# Python 3
python3 -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000
```

#### 方式三：使用 Node.js

```bash
npx http-server -p 8000
```

### 使用说明

1. 打开 `index.html` 进入系统首页
2. 点击相应的功能模块卡片进入对应页面
3. 各页面支持筛选、查询、导出等操作

## 🚀 部署到 Vercel

### 方式一：通过 Git 部署（推荐）

1. 将代码推送到 GitHub/GitLab
2. 访问 https://vercel.com/new
3. 导入仓库，选择 `V2` 目录
4. 点击 Deploy

### 方式二：通过 CLI 部署

```bash
# 安装 Vercel CLI
npm install -g vercel

# 在 V2 目录下运行
cd V2
vercel
```

### 配置说明

项目已包含 `vercel.json` 配置文件，无需额外配置即可部署。

详细部署指南请查看：[DEPLOYMENT.md](./DEPLOYMENT.md)

## 核心业务流程

### 流程1：采购到发票完整流程
1. **SKU明细生成** → 生成采购SKU明细记录
2. **生成合同** → 自动或手动生成采购合同
3. **合同审核签署** → 合同经过审核和双方签署
4. **收到发票** → 供应商开具发票并登记到系统
5. **关联发票** → 将合同与发票建立关联关系
6. **发票匹配** → 将进项发票与待开票记录进行匹配

### 流程2：合同-发票关联场景

#### 一对一场景
```
合同A (¥226,000) → 发票1 (¥226,000)
```

#### 多对一场景（合并开票）
```
合同A (¥124,300) ↘
                  → 发票1 (¥226,000)
合同B (¥101,700) ↗
```

## 注意事项

1. **金额校验：** 多对一关系中，系统会自动校验发票金额是否等于所有关联合同金额之和
2. **关联约束：** 已关联发票的合同，解除关联前需确认是否有其他业务依赖
3. **合同变更：** 合同信息变更时，需重新确认发票关联关系
4. **发票匹配：** 进项发票匹配按"价税合计"金额进行

## 后续优化方向

1. 集成后端API接口
2. 添加用户权限管理
3. 增强数据校验规则
4. 添加审批流程引擎
5. 支持电子签章集成
6. 添加数据分析和报表功能

## 版本历史

### V2 (当前版本)
- 实现采销SKU明细管理
- 实现采销合同管理
- 实现进项发票管理
- **重点：实现合同-发票关联关系管理（一对一、多对一）**
- 创建统一的导航首页
- 优化UI/UX设计

### V1
- 基础功能原型


