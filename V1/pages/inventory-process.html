                <h2 style="margin-bottom: 20px;">虚拟库存池流程</h2>
                <!-- 业务流程说明卡片 -->
                <div class="inventory-pool" style="margin-bottom: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 18px;">📌 业务流程概述</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; line-height: 1.8;">
                        <p style="margin-bottom: 10px;"><strong>关联库存ID：1（SKU: LC001-1-L）</strong></p>
                        <ul style="margin: 15px 0; padding-left: 25px;">
                            <li style="margin-bottom: 8px;"><strong>步骤1：</strong>采购入库 10,000 件</li>
                            <li style="margin-bottom: 8px;"><strong>步骤2：</strong>销售出库 6,000 件</li>
                            <li style="margin-bottom: 8px;"><strong>步骤3：</strong>工厂未结算前，退货 1,000 件（✅ 允许）</li>
                            <li style="margin-bottom: 8px;"><strong>步骤4：</strong>工厂端结算 10,000 件</li>
                            <li style="margin-bottom: 8px;"><strong>步骤5：</strong>工厂结算后尝试退货（❌ 拒绝）</li>
                            <li style="margin-bottom: 8px;"><strong>步骤6：</strong>尝试超量消耗（验证规则）</li>
                        </ul>
                    </div>
                </div>

                <!-- 虚拟库存池状态变化表 -->
                <div class="inventory-pool">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 18px;">📊 虚拟库存池状态变化</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>步骤</th>
                                <th>业务操作</th>
                                <th>入库数量</th>
                                <th>消耗</th>
                                <th>结算数</th>
                                <th>退货数</th>
                                <th>真实结算数</th>
                                <th>说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #f8f9fa;">
                                <td><strong>初始状态</strong></td>
                                <td>-</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>库存池为空</td>
                            </tr>
                            <tr>
                                <td><span class="status status-active">步骤1</span></td>
                                <td>采购入库</td>
                                <td style="color: #27ae60; font-weight: bold;">10,000</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>采购单PO-1235入库10,000件，增加"入库数量"</td>
                            </tr>
                            <tr>
                                <td><span class="status status-active">步骤2</span></td>
                                <td>销售出库</td>
                                <td>10,000</td>
                                <td style="color: #e67e22; font-weight: bold;">6,000</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>订单FBA192RDMZPS出库6,000件，增加"消耗"</td>
                            </tr>
                            <tr>
                                <td><span class="status status-active">步骤3</span></td>
                                <td>工厂未结算前退货</td>
                                <td>10,000</td>
                                <td>6,000</td>
                                <td>0</td>
                                <td style="color: #27ae60; font-weight: bold;">1,000</td>
                                <td>0</td>
                                <td style="color: #27ae60;">✅ 成功：退货单TH-20250901-001退货1,000件，工厂未结算前允许退货，增加"退货数"</td>
                            </tr>
                            <tr>
                                <td><span class="status status-warning">步骤4</span></td>
                                <td>工厂结算</td>
                                <td>10,000</td>
                                <td>6,000</td>
                                <td style="color: #3498db; font-weight: bold;">10,000</td>
                                <td>1,000</td>
                                <td style="color: #3498db; font-weight: bold;">9,000</td>
                                <td>工厂结算10,000件，增加"结算数"，真实结算数=结算数-退货数=10,000-1,000=9,000</td>
                            </tr>
                            <tr style="background: #ffebee;">
                                <td><span class="status status-error">步骤5</span></td>
                                <td>结算后尝试退货（拒绝）</td>
                                <td>10,000</td>
                                <td>6,000</td>
                                <td>10,000</td>
                                <td>1,000</td>
                                <td>9,000</td>
                                <td style="color: #e74c3c;">❌ 失败：尝试退货500件被拒绝，原因：工厂已结算，不允许再退货</td>
                            </tr>
                            <tr style="background: #ffebee;">
                                <td><span class="status status-error">步骤6</span></td>
                                <td>超量消耗（拒绝）</td>
                                <td>10,000</td>
                                <td>6,000</td>
                                <td>10,000</td>
                                <td>1,000</td>
                                <td>9,000</td>
                                <td style="color: #e74c3c;">❌
                                    失败：尝试出库5,000件被拒绝，剩余可用库存3,000件（入库数量-消耗-退货数=10,000-6,000-1,000=3,000），不能超过可用库存
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 字段说明 -->
                <div class="inventory-pool" style="margin-top: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 18px;">📖 字段说明</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                        <div
                            style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #27ae60;">
                            <strong style="color: #27ae60;">入库数量</strong>
                            <p style="margin: 8px 0 0 0; color: #555; font-size: 14px;">
                                从工厂采购入库的总数量，此字段一经录入不可更改，保持历史记录的完整性</p>
                        </div>
                        <div
                            style="background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #e67e22;">
                            <strong style="color: #e67e22;">消耗</strong>
                            <p style="margin: 8px 0 0 0; color: #555; font-size: 14px;">
                                因销售出库而消耗的库存数量，用于计算可用库存和财务成本结转
                            </p>
                        </div>
                        <div
                            style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                            <strong style="color: #3498db;">结算数</strong>
                            <p style="margin: 8px 0 0 0; color: #555; font-size: 14px;">
                                与工厂约定的结算数量，通常在一段时间后确认，用于财务应付账款核算
                            </p>
                        </div>
                        <div
                            style="background: #ffebee; padding: 15px; border-radius: 8px; border-left: 4px solid #e74c3c;">
                            <strong style="color: #e74c3c;">退货数</strong>
                            <p style="margin: 8px 0 0 0; color: #555; font-size: 14px;">因质量问题等原因退回给工厂的数量，冲减应付账款</p>
                        </div>
                        <div
                            style="background: #f3e5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #9c27b0;">
                            <strong style="color: #9c27b0;">真实结算数</strong>
                            <p style="margin: 8px 0 0 0; color: #555; font-size: 14px;">实际需要与工厂结算的数量，计算公式：真实结算数 =
                                结算数 -
                                退货数</p>
                        </div>
                    </div>
                </div>

                <!-- 库存池变更记录关联 -->
                <div class="inventory-pool" style="margin-top: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 18px;">🔗 库存池变更记录</h3>
                    <p style="color: #555; margin-bottom: 15px;">每次虚拟库存池字段发生变化时，都会在"库存池变更记录"中生成对应的记录，便于审计和追溯：</p>
                    <table>
                        <thead>
                            <tr>
                                <th>记录ID</th>
                                <th>消耗类型</th>
                                <th>关联库存ID</th>
                                <th>数量</th>
                                <th>影响字段</th>
                                <th>业务单据</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td><span class="status status-active">采购入库</span></td>
                                <td>1</td>
                                <td>10,000</td>
                                <td>入库数量 +10,000</td>
                                <td>采购单号：PO-1235</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td><span class="status status-active">销售出库</span></td>
                                <td>1</td>
                                <td>6,000</td>
                                <td>消耗 +6,000</td>
                                <td>订单号：FBA192RDMZPS</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td><span class="status status-active">采购退货（未结算）</span></td>
                                <td>1</td>
                                <td>1,000</td>
                                <td>退货数 +1,000</td>
                                <td>退货单号：TH-20250901-001</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td><span class="status status-warning">工厂结算</span></td>
                                <td>1</td>
                                <td>10,000</td>
                                <td>结算数 +10,000</td>
                                <td>采购单号：PO-1235</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td><span class="status status-error">结算后退货（拒绝）</span></td>
                                <td>1</td>
                                <td>500</td>
                                <td>无变化（拒绝）</td>
                                <td>退货单号：TH-20250925-001</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td><span class="status status-error">超量消耗（拒绝）</span></td>
                                <td>1</td>
                                <td>5,000</td>
                                <td>无变化（拒绝）</td>
                                <td>订单号：ORD-20250925-001</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 关键要点 -->
                <div class="inventory-pool" style="margin-top: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 18px;">💡 财务合规关键要点</h3>
                    <div
                        style="background: #fff9e6; padding: 20px; border-radius: 8px; border-left: 4px solid #f39c12;">
                        <ul style="margin: 0; padding-left: 25px; line-height: 2;">
                            <li><strong>数据不可篡改：</strong>"入库数量"字段一经录入不可修改，确保历史数据的完整性和可追溯性</li>
                            <li><strong>退货处理：</strong>退货不减少"入库数量"，而是通过"退货数"字段单独记录，保持审计线索清晰</li>
                            <li style="color: #e74c3c;"><strong>⚠️
                                    退货限制：</strong>只有在工厂未结算前才允许退货，一旦工厂结算完成（结算数>0），则不允许再进行退货操作</li>
                            <li><strong>财务结算：</strong>最终与工厂结算时，使用"真实结算数"（结算数-退货数）作为计算依据</li>
                            <li><strong>库存消耗：</strong>"消耗"字段仅记录销售出库，不包含退货，两者分别核算</li>
                            <li><strong>不能超量消耗：</strong>可用库存=入库数量-消耗-退货数，出库数量不能超过可用库存，系统会自动拒绝超量消耗请求</li>
                            <li><strong>全程可追溯：</strong>所有变更都在"库存池变更记录"中留痕，支持完整的审计追溯</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- 结束虚拟库存池流程区域 -->

